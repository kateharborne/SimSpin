"0",""
"0","image_nan <- function(z, zlim, col, na.color='gray', ...){"
"0","  zstep <- (zlim[2] - zlim[1]) / length(col); # step in the color palette"
"0","  newz.na <- zlim[2] + zstep # new z for NA"
"0","  "
"0","  z[which(is.na(z>zlim[2]))] <- newz.na # same for newz.na"
"0","  "
"0","  zlim[2] <- zlim[2] + zstep # extend top limit to include the new value na"
"0","  "
"0","  col <- c(col, na.color) # we construct the new color range by including: na.color"
"0","  "
"0","  magicaxis::magimage(z=z, zlim=zlim, col=col, ...) # we finally call image(...)"
"0","}"
"0","velo_map_cols = rev(colorRampPalette(RColorBrewer::brewer.pal(9, ""RdYlBu""))(40))"
"0","disp_map_cols = colorRampPalette(RColorBrewer::brewer.pal(9, ""YlOrRd""))(50)"
"0",""
"0","vel_val = max(c(abs(min(example_cube$velocity_image, na.rm = T)), abs(max(example_cube$velocity_image, na.rm = T))))"
"0","disp_val = c(floor(min(example_cube$dispersion_image, na.rm=T)/2), max(example_cube$dispersion_image, na.rm=T))"
"0",""
"0","par(pty=""s"", fig=c(0,0.5,0,1), options(scipen = 999), xpd=FALSE, ps=12, cex=1)  "
"0","image_nan(z = example_cube$velocity_image, zlim = c(-vel_val,vel_val), col = velo_map_cols, na.color = ""white"", xaxt=""n"","
"0","          yaxt=""n"", ann=FALSE, magmap=FALSE, family=""mono"", font=1)"
