# SimSpin v2.3.17 News

### Author: Kate Harborne

### Last edit: 15/09/22

Below is a table containing a summary of all changes made to SimSpin, since the date this file was created on 26/08/2021.

Version-ing follows a semantic formula:

-   The first value (i.e. [0].X.X) only changes when breaking changes are introduced. This will be in the case of a major update of features in the code.

-   The second value (i.e. X.[0].X) changes when a significant, but non-breaking change, is introduced that may cause the user to see warnings on older code, but the output will still be produced.

-   The final value (i.e. X.X.[0]) changes when any change is made to the code. These will often be minor updates that are introducing a new minor feature or bugfix.

All changes are noted in the changelog table below.

| Date     	| Summary of change                                                                                                                                                                                                                                                                                                                                                                                                        	| Version 	| Commit                                   	|
|----------	|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------	|---------	|------------------------------------------	|
| 15/09/22 	| *Minor bugfix.* Addressing issue #69 (nee #59 which was not actually fixed in previous attempts!). Removing final long entry ("aperture_region") from OBS_TABLE so that entries are never too long to be written to a FITS table.                                                                                                                                                                                        	| 2.3.17  	|                                          	|
| 24/08/22 	| *Minor bugfix*. Addressing issue #66. Prior to v2.3.16, gas particle SFRs have been stored in units of g/s rather than Msol/yr. This has been fixed within the `make_simspin_file` function from v2.3.16 and any SimSpin files \< v2.3.16 will now issue a warning when building a gas observation with `build_datacube` and `method = 'gas'` and adjust the SFR units. Other updates include:                           	| 2.3.16  	| 8e0f382a825791cd2026c72c8eefea9006d75f11 	|
|          	| (1) Warnings issued when method requested is not possible with the input SimSpin file (i.e. `method = "gas"` when the file contains no stellar particles.                                                                                                                                                                                                                                                                	|         	|                                          	|
|          	| (2) Warnings issued if you request a half-mass radius alignment with an n-body input simulation (as these are now not aligned by default).                                                                                                                                                                                                                                                                               	|         	|                                          	|
|          	| (3) Addition of `filter_name` to `telescope` for clarity in the output observation table.                                                                                                                                                                                                                                                                                                                                	|         	|                                          	|
| 12/08/22 	| *Minor bugfix*. Addressing issue #64. Galaxy simulations will not be `align`ed if the input is from an 'nbody' simulation. This avoids the flip/flop effect in between snapshot time steps. Other changes include the default for `signal-to-noise` to be set to `NA` for ease in the SimSpin app. If no value is specified, no noise will be added to the observation. This is now updated also in the documentation.   	| 2.3.15  	| 74b569992f3db0b1d0b5a46c06e64d510479e94b 	|
| 03/08/22 	| *Minor bugfix*. Addressing issue #60. Ensuring that raw images produced for any stellar mode observations (i.e. `method="spectral"` or `method="velocity"`) are consistent. New images added to spectral mode outputs (age and metallicity summaries) and all updated to mass weighted quantities.                                                                                                                       	| 2.3.14  	| 6ab467718664be1db0fa653b0fb219d073472d43 	|
| 01/08/22 	| *Minor bugfix*. Addressing Issue #59 (which was not actually fixed in previous attempt!). Making sure long entries (i.e. wave_seq, vbin_seq or sbin_seq) are never too long to be written to a FITS table. Change to range (i.e. min and max) to remove this as an issue.                                                                                                                                                	| 2.3.13  	| eee7c31c8686a5056ff3419136cb384d40693e50 	|
| 29/07/22 	| *Minor bugfix*. Addressing Issue #59. Making sure any NA values within the `observation` list are re-written as "None" in characters before writing to FITS.                                                                                                                                                                                                                                                             	| 2.3.12  	| 91e8e890e3154169b7bb078e80efe979c006667b 	|
| 28/07/22 	| *Minor bugfix*.                                                                                                                                                                                                                                                                                                                                                                                                          	| 2.3.11  	| c7114e4727e7eb2396d9af075c85df17b6c950e2 	|
|          	| (1) Update to `write_simspin_FITS`. The `observation` summary output by `build_datacube` was previously never saved to the FITS file output. However, this makes it difficult to reproduce if the only saved output is a FITS file. With this update, the list `observation` is now written to a table in EXTNUM = 3 for all FITS files produced.                                                                        	|         	|                                          	|
|          	| (2) Update to `method = "gas"`. Particle images will now be output when method is `gas`, along with both the raw and observed mass, velocity and dispersion maps. This mode was not updated with the `spectral` and `velocity` modes in v2.3.8 upgrade. This has now been remedied.                                                                                                                                      	|         	|                                          	|
|          	| (3) Addition of plotting functions for the gas mode specific images: `plot_SFR` and `plot_OH`.                                                                                                                                                                                                                                                                                                                           	|         	|                                          	|
| 27/07/22 	| *Minor bugfix.* Update to `make_simspin_file` to increase the level of compression for output files. This will have no change on functions down the line. Also, fixed the units for `plot_h4` which was writing "km/s" when there are no units for h4.                                                                                                                                                                   	| 2.3.10  	| be0c281cb69f7352d3a88f59f7777bbffdc149d6 	|
| 22/07/22 	| **New feature!** Update to add plotting functions. A suite of functions with standard colour maps for each image type: `plot_flux`, `plot_mass`, `plot_velocity`, `plot_dispersion`, `plot_h3`, `plot_h4`, `plot_age`, `plot_metallicity` and `plot_particles`. Axis names and colour bars can be modified by the user. All new functions are tested and documented.                                                     	| 2.3.9   	| 2aceb04d6e40196168de13c4bbd450280de46c4d 	|
| 21/07/22 	| *Minor bugfix*. With update to v2.3.5, flux conservation was implemented in mode="velocity". During this upgrade, filters were properly implemented meaning that re-run observations will now produce flux maps = 0 where previously they had flux. This occurs when the filter wavelength range does not overlap with the observed telescope wavelength range.                                                          	| 2.3.8   	| e043f8302ea8f5d0ac189a44edf33b6ceb866f50 	|
|          	| (1) Errors now issued by `telescope` if you request a filter that will not allow any flux through the telescope wavelength range.                                                                                                                                                                                                                                                                                        	|         	|                                          	|
|          	| (2) Default filter has been changed in `telescope` to `filter = "g"` so that there is overlap between the default parameters.                                                                                                                                                                                                                                                                                            	|         	|                                          	|
|          	| (3) Errors issued if the requested `half_mass` in `make_simspin_file` is greater than the total mass contained in the input simulation file OR if smaller than the mass of a single particle.                                                                                                                                                                                                                            	|         	|                                          	|
|          	| (4) All images are now written to FITS (not just a selection dependent on the method selected). Default names for files now include a prefix "raw_" or "obs_" to denote which list the image comes from within the build_datacube output.                                                                                                                                                                                	|         	|                                          	|
| 19/07/22 	| **New feature!** Update to `build_datacube`. Observed images produced with method = 'velocity' now include measured h3 and h4 higher order kinematics. This is done by fitting the LOSVD within the output velocity cube with a Gauss-Hermite polynomial. These images are now included and written to single or split FITS.                                                                                             	| 2.3.7   	| 2dbca740c29637f8802f1c92ce48ca0b215f5458 	|
| 18/07/22 	| *Minor bugfix*. Update to `make_simspin_file`. Modifying how gas particles are smoothed for HorizonAGN simulations - rather than a uniform smoothing across the cell cube, we now assign a smoothing length dependent on the mass/density and smooth with a cubic spline.                                                                                                                                                	| 2.3.6   	| fcd915985e6ad477538c7f4be3c08428d0fd7fe1 	|
| 18/07/22 	| *Minor bugfix*. Update to `build_datacube`. Implementing enforced flux conservation across the telescope wavelength range between input template and output observed spectrum. Fix for both spectral and velocity cubes. Tests added to ensure that outputs in parallel and series are identical.                                                                                                                        	| 2.3.5   	| bf4556234127c7352604863b24b4649c9fda5341 	|
| 12/07/22 	| *Minor bugfix*. Update to `build_datacube`. Returning a meaningful error if the requested `centre` position is outside the range of the provided input file. Tests added to ensure behaviour now works as expected.                                                                                                                                                                                                      	| 2.3.4   	| 30a30eb4758a87edbeb7345f1d62d3b256ad5ff2 	|
| 01/07/22 	| *Minor bugfix*. Adding support for ingestion of HorizonAGN data (i.e. AMR code data support). Updates to `make_simspin_file`, `utilities` and tests were implemented. Addresses Issue #42. Also, made observational images consistent with raw images (removing NAs and replacing with 0's).                                                                                                                             	| 2.3.3   	| e4ca02bf3ab482a0fd9a1abd6e2442c0e4a41da4 	|
| 27/06/22 	| *Minor bugfix*. Updating `build_datacube` to make sure backwards compatibility. If a SimSpin file from versions preceading v2.3.0 are used with the function, it now assumes a header based on the wavelength information. This will also issue a warning to explain and encourage the user to remake their SimSpin file. Errors if custom template is used with no details of LSF or wave_res. Addresses Issue #45.     	| 2.3.2   	| cfdfdbf304df0243efd608539d5087e09a223525 	|
| 20/06/22 	| *Minor bugfix*. Updating `telescope` class to allow two modes of spatial resolution of the MUSE telescope. This addresses Issue #43. Similarly, we've added the requirement for the MUSE field-of-view to be less than 60" and for MaNGA fov to be from the specific selection of options (12, 17, 22, 27, 32).                                                                                                          	| 2.3.1   	| dbba3af4c926e9c8c9e2a650d22dee2bf0d0f837 	|
| 13/06/22 	| *Medium change* Update to `build_datacube()` and `make_simspin_file()` -                                                                                                                                                                                                                                                                                                                                                 	| 2.3.0   	| 62afd85ecd11bfdfb91832d8de49c9abe40eca9f 	|
|          	| (1) Output SimSpin files now include an additional `header` element describing the code version with which the file was made, the properties and name of the template used to derive particle spectra, and the type of input simulation.                                                                                                                                                                                 	|         	|                                          	|
|          	| (2) The LSF treatment in `build_datacube` has been modified to account for the fact that the underlying spectral templates have a LSF themselves, and it is only necessary to convolve these up by the mean-square difference between the teescope LSF and the input template.                                                                                                                                           	|         	|                                          	|
| 24/05/22 	| *Medium change* Update to `build_datacube()` -                                                                                                                                                                                                                                                                                                                                                                           	| 2.2.0   	| caf72303e8301e5c06f6c401bb250eb047da6c23 	|
|          	| (1) `method` of observation is now specified directly in the `build_datacube` function - rather than within `telescope()`. This means that a given telescope can be specified once, while the type of cube being built can be modified. This is more logical as an inbuilt telescope type now only needs to be specified by "type".                                                                                      	|         	|                                          	|
|          	| (2) `output_location` has modified behaviour to allow a user to just specify an output PATH (rather than having to auto-save FITS to the same directory as the input SimSpin file). Documentation updated to reflect this change.                                                                                                                                                                                        	|         	|                                          	|
| 24/03/22 	| *Minor bugfix*. Modifying how particle and spectral data are treated in the back-end of the code to reduce memory load. Also, removed ProSpect depenedency and [fixed bug in interp_quick()](https://github.com/asgr/ProSpect/issues/7) where interpolation above the expected range was returning a value rather than an index.                                                                                         	| 2.1.5   	| ba8e95f704fe4d0c0faf38fc198091c28f07cdd8 	|
| 14/03/22 	| *Minor bugfix*. Specifying all initialised arrays with the correct type (rather than initiallised `NA`s) to imporve code memory handling and speed.                                                                                                                                                                                                                                                                      	| 2.1.4   	| 6a4c46fe9da4d2bafbecd1251ae7b97664cba970 	|
| 03/03/22 	| *Minor bugfix*. Specifying branch of ProSpect in the remotes installation.                                                                                                                                                                                                                                                                                                                                               	| 2.1.3   	| a8b45bafa139304ee5d66d559b9b1cb0f510e365 	|
| 23/02/22 	| Update to `write_simspin_FITS()` and `build_datacube()` -                                                                                                                                                                                                                                                                                                                                                                	| 2.1.2   	|                                          	|
|          	| (1) Adding the ability to `split_save` to both functions i.e. when the input data includes both the cube and summary images, this mode give the user to option to save all components into seperate files automatically. If "FALSE" (as default), all components will be saved into subsequent HDU's of the output FITS file.                                                                                            	|         	|                                          	|
|          	| (2) Modifying the EXTNAME for the HDU associated with the "raw" particle data (now prefixed with `"RAW_"`) and the "observed" collapsed velocity data cubes (now prefixed with `"OBS_").`                                                                                                                                                                                                                                	|         	|                                          	|
|          	| (3) Update to the depends version number of R. Now requires R >= 4.0. This is to enable the generation of a container for the web application of SimSpin.                                                                                                                                                                                                                                                                	|         	|                                          	|
| 03/02/22 	| Update to `write_simspin_FITS()` and `observation()` -                                                                                                                                                                                                                                                                                                                                                                   	| 2.1.1   	| fe8729b86d9b670ed64ea68a3f3c25433cbcd803 	|
|          	| (1) Adding in the SimSpin version number with which the observation has been run against the keyword `origin`.                                                                                                                                                                                                                                                                                                           	|         	|                                          	|
|          	| (2) Modifying the output `RA` and `DEC` keywords to allow the user to specify the (x,y,z) position of the simulated galaxy within the simulation box and produce a unique RA/DEC value (assuming the observer sits at (0,0,0) in the box!)                                                                                                                                                                               	|         	|                                          	|
| 26/11/21 	| Update to `write_simspin_FITS()` - renaming the keywords in the FITS cubes output (header of HDU = 2) for all output files (i.e.mode = `spectral`, `velocity` and `gas`). Adjusted so that post processing with pPXF is consistent. Thanks @margarita-luna!                                                                                                                                                              	| 2.0.6   	| 8c8302af61058c6772cbda1d64b3cc578cbeac8f 	|
| 24/01/22 	| Updates to `observing_strategy` -                                                                                                                                                                                                                                                                                                                                                                                        	| 2.1.0   	|                                          	|
|          	| (1) Allow user to specify the 'pointing' of the telescope relative to the centre of the galaxy. Can be specified using (x,y) offsets in kpc (`pointing_kpc`) or deg (`pointing_deg`). Useful for observing galaxies that are closer to the observer than the aperture width allows for the full object to be seen in one observation.                                                                                    	|         	|                                          	|
|          	| (2) Modification to input names. Specifying projected distance can now be done in terms of redshift distance, physical distance (i.e. in Mpc) or angular scale (i.e. specifying kpc per arcsecond). These are now called `dist_z`, `dist_Mpc` and `dist_kpc_per_arcsec`. See `?observing_strategy` for more details.                                                                                                     	|         	|                                          	|
|          	| (3) Break changes avoided by still allowing users to specify `z` to indicate projected distance. A depreciation warning will also be issues when specifying `z` rather than `dist_z` however.                                                                                                                                                                                                                            	|         	|                                          	|
| 11/11/21 	| A few updates to `build_datacube()` -                                                                                                                                                                                                                                                                                                                                                                                    	| 2.0.5   	| 07e9a099c3fdfb5ae4ddbf587a0bf8b191b86f12 	|
|          	| (1) When blurring velocity cubes, objects were being returned with the name `spectral_cube` despite the v2.0.4 updates. This has now been raised in issue #16 and fixed in latest commit.                                                                                                                                                                                                                                	|         	|                                          	|
|          	| (2) No particles images were generated in spectral mode. This was raised in issue #15 and solved in later commit. Spectral mode will now return an image containing the number of particles per pixel within the `raw_images` header.                                                                                                                                                                                    	|         	|                                          	|
|          	| (3) Adding these raw images as HDU in the spectral FITS file produced. All raw images included so 4 extra HDU.                                                                                                                                                                                                                                                                                                           	|         	|                                          	|
|          	| Tests added include:                                                                                                                                                                                                                                                                                                                                                                                                     	|         	|                                          	|
|          	| (1) Check that in `mode = velocity` and `blur = T`, returned object includes an array named `velocity_cube` and not `spectral_cube`.                                                                                                                                                                                                                                                                                     	|         	|                                          	|
|          	| (2) Update the number of expected images in the `raw_images` header to be 4 rather than 3 (now with added particle number image for spectral mode).                                                                                                                                                                                                                                                                      	|         	|                                          	|
| 20/09/21 	| ~~Adding in optional Voronoi binning to increase particle counts per pixel. Unfinished at this stage, but introduces no breaking changes. New minor version number will be included once implemented.~~ **Moved to new branch 25/11/21 - dev-Voronoi.**                                                                                                                                                                  	| 2.0.5   	| 2d1dd7f802d67fe9dd286888923f3ac1f9ea5889 	|
| 26/08/21 	| Adjusting the images output from the `build_datacube()` function to have clearer labels -  images until v2.0.3 have been produced as raw particle images before convolution with a PSF,  though this was unclear. To improve, the following changes have been implemented:                                                                                                                                               	| 2.0.4   	| b6b6089a6295d2a47794be100e04494261e79476 	|
|          	| (1) `raw_images` output as a list of arrays. These images contain the raw binned particle data.  Specific images included depends on the `method` chosen in the `telescope()` function.                                                                                                                                                                                                                                  	|         	|                                          	|
|          	| (2) `observed_images` output as a list of arrays. These images are produced by collapsing the  observed cube to produce kinematic maps. The observed maps from a `method="spectral"` cube  will be `NULL`, as these would be produced using pPXF.                                                                                                                                                                        	|         	|                                          	|
|          	| Required changes made to `write_FITS_file()` function to deal with the new list format.                                                                                                                                                                                                                                                                                                                                  	|         	|                                          	|
|          	| Tests added include:                                                                                                                                                                                                                                                                                                                                                                                                     	|         	|                                          	|
|          	| (1) Expecting all output data cubes to have length = 4.                                                                                                                                                                                                                                                                                                                                                                  	|         	|                                          	|
|          	| (2) Expecting all `mode="spectral"` outputs to have `raw_images` as a list, length = 3, and `observed_images = NULL`.                                                                                                                                                                                                                                                                                                    	|         	|                                          	|
|          	| (3) Expecting all `mode="velocity"` outputs to have `raw_images` as a list, length = 6, and `observed_images` as a list, length = 3.                                                                                                                                                                                                                                                                                     	|         	|                                          	|
|          	| (4) When `mass_flag=T`, there should be an array image in each of the lists that is called `mass_image` rather than `flux_image`.                                                                                                                                                                                                                                                                                        	|         	|                                          	|
